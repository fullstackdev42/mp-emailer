version: '3'

vars:
  BINARY_NAME: mp-emailer
  GO_FILES: '$(find . -name "*.go" -type f -not -path "./vendor/*")'
  BIN_DIR: bin

tasks:
  default:
    cmds:
      - task: run

  build:
    desc: Build the application
    cmds:
      - mkdir -p {{.BIN_DIR}}
      - go build -o {{.BIN_DIR}}/{{.BINARY_NAME}} .

  run:
    desc: Run the application
    deps: [build]
    cmds:
      - ./{{.BIN_DIR}}/{{.BINARY_NAME}}

  test:
    desc: Run tests
    cmds:
      - go test ./... -v

  lint:
    desc: Lint the code
    cmds:
      - golangci-lint run

  fmt:
    desc: Format the code
    cmds:
      - gofmt -s -w {{.GO_FILES}}

  clean:
    desc: Clean build artifacts
    cmds:
      - rm -rf {{.BIN_DIR}}

  all:
    desc: Run all tasks (lint, test, build)
    cmds:
      - task: lint
      - task: test
      - task: build
